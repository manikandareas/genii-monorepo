import { NextResponse } from "next/server"; import { withAuth } from "next-auth/middleware"; export default withAuth(function middleware(req) { const { pathname } = req.nextUrl; const token = req.nextauth?.token; if (pathname.startsWith("/admin") && !token?.isAdmin) { return NextResponse.redirect(new URL("/login", req.url)); } if (!pathname.startsWith("/onboarding") && !pathname.startsWith("/api") && token && !token.isAlreadyOnboard) { return NextResponse.redirect(new URL("/onboarding", req.url)); } return NextResponse.next(); }, { callbacks: { authorized: ({ token }) => !!token, }, }); export const config = { matcher: [ "/courses/:path*", "/profile/:path*", "/admin/:path*", "/notes/:path*", "/bookmarks/:path*", "/onboarding/:path*", ], };
